#!/usr/bin/env ruby

def run_migration
  puts "Running migration..."
  puts `bundle exec rake db:migrate`
end

def start_server
  pid_file  = ENV.fetch('RAILS_PID')     { '/opt/app/tmp/pids/gifts.pid' }
  listen    = ENV.fetch('RAILS_LISTEN')  { '0.0.0.0' }
  port      = ENV.fetch('RAILS_PORT')    { '3000' }

  exec "bundle", "exec", "rails", "server", "--pid", pid_file , "--binding", listen, "--port", port
end

run_migration
start_server
