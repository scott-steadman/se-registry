<% if current_user != page_user %>
<h1><%= possessivize(page_user.display_name) %> Gifts</h1>
<% end %>

<div id='notes'>
  <h2>Notes:</h2>
  <pre><%= page_user.notes %></pre>
</div>

<ul class='o-inline-list'>
  <li><%= link_to 'New',    new_user_gift_path(page_user), :class => 'o-button' %></li>
  <li><%= link_to 'Export', user_gifts_path(page_user, :format => 'csv'), :class => 'o-button' %></li>
  <%- if params[:tag] -%>
  <li>Tagged:
    <%= link_to(url_for(:tag => nil), :class => 'o-button u-destructive o-link--with-icon') do -%>
      <%= h(params[:tag]) %> <%= image_tag('delete-icon.svg') %>
    <%- end -%>
  </li>
  <%- end -%>
  <li>Sorted By: <%= select_tag('order', sort_options, :onChange => "window.location=replaceOrder(this.value);") %></li>
</ul>

<div id='gift-list'>
  <%= render :partial => 'gift', :collection => @gifts %>
</div>

<script>
  function replaceOrder(value) {
    var key       = 'order';
    var uri       = window.location.search;
    var regex     = new RegExp("([?&])" + key + "=.*?(&|$)", "i");
    var separator = uri.indexOf('?') !== -1 ? "&" : "?";
    var result    = '';

    if (uri.match(regex)) {
      result = uri.replace(regex, '$1' + key + "=" + value + '$2');
    } else {
      result = uri + separator + key + "=" + value;
    }

    return result;
  }
</script>
